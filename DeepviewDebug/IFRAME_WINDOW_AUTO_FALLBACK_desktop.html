<html>
<head>
<script>
// IFRAME_WINDOW_AUTO_FALLBACK - DESKTOP

const urlParams = new URLSearchParams(window.location.search);
const primary = urlParams.get('primary');
const action = urlParams.get('action');
const secondary = urlParams.get('secondary');

var hasURI = false;
var intervalExecuted = false;
var focusExecuted = false;
window.onload = function() {
  var iframe = document.createElement("iframe");
  iframe.style.border = "none";
  iframe.style.width = "1px";
  iframe.style.height = "1px";
  iframe.src = primary;
  document.body.appendChild(iframe);
  setTimeout(function timeout() {
    if (!hasURI) {
      window.top.location.replace(secondary);
    }
    intervalExecuted = true;
  }, 500);
};
window.onblur = function() {
  hasURI = true;
};
window.onfocus = function() {
  if (!focusExecuted && hasURI) {
    focusExecuted = true;
    window.top.location = secondary;
  } else if (!focusExecuted && intervalExecuted) {
    focusExecuted = true;
    window.top.location = secondary;
  }
};

</script>
</head>
<body>
  <div class="sub-heading">

    <h3>IFRAME_WINDOW_AUTO_FALLBACK - DESKTOP</h3>

    To change the redirect locations used in this template, change the query params in the URL!
    <br>
    primary = the first thing we try to open (usually passively)
    <br>
    action = usually a branch link, sometimes used as the fallback by some templates
    <br>
    secondary = the fallback in most cases, instead of action
  </div>
</body>
</html>